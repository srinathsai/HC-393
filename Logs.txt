 [Config] Loading settings...
âœ… [Config] Settings loaded
   OpenAI model: gpt-4o
   Temperature: 0.35
   Max tokens: 2000
   Final context chunks: 50

================================================================================
âš¡ PROCESSING: BEK Bruno - FP.pdf
ğŸ†” Doc ID: 72ff19e0-5f98-4ee8-8484-72dce335df53
================================================================================

ğŸ”§ Step 1: Initializing services...
   ğŸ“‚ ChromaDB path: C:\chroma\construction_graph
ğŸ”§ [EntityExtractor] Initializing with model: gpt-4o
âœ… [EntityExtractor] Ready
   âœ… All services ready

ğŸ“– Step 2: PDF Processing...
   ğŸ“„ Opening PDF...
   ğŸ“Š Found 38 pages
   ğŸ”„ Processing in 19 batches of 2 pages each...

   âš™ï¸ Batch 1/19: pages 1-2...
   âœ… Created 2 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 6 entities, 0 relationships
   âœ… LLM extraction: 5 entities, 3 relationships
   âœ… Total after deduplication: 11 entities, 3 relationships
      âœ… Batch 1 complete: 5 chunks, 11 entities
   âš™ï¸ Batch 2/19: pages 3-4...
   âœ… Created 2 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 16 entities, 0 relationships
   âœ… LLM extraction: 13 entities, 4 relationships
   âœ… Total after deduplication: 29 entities, 4 relationships
      âœ… Batch 2 complete: 5 chunks, 29 entities
   âš™ï¸ Batch 3/19: pages 5-6...
   âœ… Created 2 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 6 entities, 0 relationships
   âœ… LLM extraction: 12 entities, 4 relationships
   âœ… Total after deduplication: 18 entities, 4 relationships
      âœ… Batch 3 complete: 5 chunks, 18 entities
   âš™ï¸ Batch 4/19: pages 7-8...
   âœ… Created 3 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 12 entities, 0 relationships
   âœ… LLM extraction: 9 entities, 8 relationships
   âœ… Total after deduplication: 21 entities, 8 relationships
      âœ… Batch 4 complete: 6 chunks, 21 entities
   âš™ï¸ Batch 5/19: pages 9-10...
   âœ… Created 3 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 16 entities, 0 relationships
   âœ… LLM extraction: 17 entities, 6 relationships
   âœ… Total after deduplication: 32 entities, 6 relationships
      âœ… Batch 5 complete: 6 chunks, 32 entities
   âš™ï¸ Batch 6/19: pages 11-12...
   âœ… Created 2 chunks from text
   âœ… Created 2 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 4 entities, 0 relationships
   âœ… LLM extraction: 5 entities, 4 relationships
   âœ… Total after deduplication: 9 entities, 4 relationships
      âœ… Batch 6 complete: 4 chunks, 9 entities
   âš™ï¸ Batch 7/19: pages 13-14...
   âœ… Created 3 chunks from text
   âœ… Created 2 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 57 entities, 0 relationships
   âœ… LLM extraction: 13 entities, 12 relationships
   âœ… Total after deduplication: 69 entities, 12 relationships
      âœ… Batch 7 complete: 5 chunks, 69 entities
   âš™ï¸ Batch 8/19: pages 15-16...
   âœ… Created 2 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 53 entities, 0 relationships
   âœ… LLM extraction: 12 entities, 8 relationships
   âœ… Total after deduplication: 65 entities, 8 relationships
      âœ… Batch 8 complete: 5 chunks, 65 entities
   âš™ï¸ Batch 9/19: pages 17-18...
   âœ… Created 2 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 13 entities, 0 relationships
   âœ… LLM extraction: 8 entities, 7 relationships
   âœ… Total after deduplication: 21 entities, 7 relationships
      âœ… Batch 9 complete: 5 chunks, 21 entities
   âš™ï¸ Batch 10/19: pages 19-20...
   âœ… Created 4 chunks from text
   âœ… Created 4 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 4 entities, 0 relationships
   âœ… LLM extraction: 10 entities, 2 relationships
   âœ… Total after deduplication: 13 entities, 2 relationships
      âœ… Batch 10 complete: 8 chunks, 13 entities
   âš™ï¸ Batch 11/19: pages 21-22...
   âœ… Created 4 chunks from text
   âœ… Created 4 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 5 entities, 0 relationships
   âœ… LLM extraction: 6 entities, 5 relationships
   âœ… Total after deduplication: 11 entities, 5 relationships
      âœ… Batch 11 complete: 8 chunks, 11 entities
   âš™ï¸ Batch 12/19: pages 23-24...
   âœ… Created 4 chunks from text
   âœ… Created 4 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 15 entities, 0 relationships
   âœ… LLM extraction: 12 entities, 10 relationships
   âœ… Total after deduplication: 23 entities, 10 relationships
      âœ… Batch 12 complete: 8 chunks, 23 entities
   âš™ï¸ Batch 13/19: pages 25-26...
   âœ… Created 4 chunks from text
   âœ… Created 4 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 4 entities, 0 relationships
   âœ… LLM extraction: 12 entities, 1 relationships
   âœ… Total after deduplication: 15 entities, 1 relationships
      âœ… Batch 13 complete: 8 chunks, 15 entities
   âš™ï¸ Batch 14/19: pages 27-28...
   âœ… Created 2 chunks from text
   âœ… Created 4 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 72 entities, 0 relationships
   âœ… LLM extraction: 6 entities, 2 relationships
   âœ… Total after deduplication: 73 entities, 2 relationships
      âœ… Batch 14 complete: 6 chunks, 73 entities
   âš™ï¸ Batch 15/19: pages 29-30...
   âœ… Created 3 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 47 entities, 0 relationships
   âœ… LLM extraction: 26 entities, 3 relationships
   âœ… Total after deduplication: 68 entities, 3 relationships
      âœ… Batch 15 complete: 6 chunks, 68 entities
   âš™ï¸ Batch 16/19: pages 31-32...
   âœ… Created 3 chunks from text
   âœ… Created 2 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 46 entities, 0 relationships
   âœ… LLM extraction: 26 entities, 7 relationships
   âœ… Total after deduplication: 66 entities, 7 relationships
      âœ… Batch 16 complete: 5 chunks, 66 entities
   âš™ï¸ Batch 17/19: pages 33-34...
   âœ… Created 3 chunks from text
   âœ… Created 2 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 11 entities, 0 relationships
   âœ… LLM extraction: 16 entities, 15 relationships
   âœ… Total after deduplication: 24 entities, 15 relationships
      âœ… Batch 17 complete: 5 chunks, 24 entities
   âš™ï¸ Batch 18/19: pages 35-36...
   âœ… Created 3 chunks from text
   âœ… Created 3 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 11 entities, 0 relationships
   âœ… LLM extraction: 11 entities, 10 relationships
   âœ… Total after deduplication: 16 entities, 10 relationships
      âœ… Batch 18 complete: 6 chunks, 16 entities
   âš™ï¸ Batch 19/19: pages 37-38...
   âœ… Created 1 chunks from text
   âœ… Created 4 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 5 entities, 0 relationships
   âœ… LLM extraction: 10 entities, 8 relationships
   âœ… Total after deduplication: 15 entities, 8 relationships
      âœ… Batch 19 complete: 5 chunks, 15 entities

   âœ… Text extraction complete: 38 pages
   âœ… Total chunks: 111
   âœ… Total entities: 599, relationships: 119

ğŸ”— Step 3: Creating vector embeddings...
   ğŸ¯ Using model: text-embedding-3-small (1536 dimensions)
   âœ… Embedded batch 1/6
   âœ… Embedded batch 2/6
   âœ… Embedded batch 3/6
   âœ… Embedded batch 4/6
   âœ… Embedded batch 5/6
   âœ… Embedded batch 6/6
   âœ… Created 111 vector points

ğŸ” Step 4: Vision extraction (first 3 pages)...
   ğŸ“¸ Processing page 1...

ğŸ–¼ï¸ [VISION EXTRACTION] Page 1
   Image size: 3190228 bytes (base64)
   ğŸ”„ Calling GPT-4o Vision API...
   âœ… Vision API response received
   âœ… JSON parsed successfully
   ğŸ“Š Diagram type detected: fire protection
   âœ… VISION EXTRACTION COMPLETE:
      Type: fire protection
      Entities: 8
      Relationships: 7
      Summary: This diagram shows the fire protection layout including sprinkler systems and fire hydrants for vari
      âœ… Page 1: 8 entities, 7 rels
   ğŸ“¸ Processing page 2...

ğŸ–¼ï¸ [VISION EXTRACTION] Page 2
   Image size: 1951376 bytes (base64)
   ğŸ”„ Calling GPT-4o Vision API...
   âœ… Vision API response received
   âœ… JSON parsed successfully
   ğŸ“Š Diagram type detected: fire protection
   âœ… VISION EXTRACTION COMPLETE:
      Type: fire protection
      Entities: 3
      Relationships: 0
      Summary: This diagram shows the fire protection plan for a freezer area.
      âœ… Page 2: 3 entities, 0 rels
   ğŸ“¸ Processing page 3...

ğŸ–¼ï¸ [VISION EXTRACTION] Page 3
   Image size: 2549540 bytes (base64)
   ğŸ”„ Calling GPT-4o Vision API...
   âœ… Vision API response received
   âœ… JSON parsed successfully
   ğŸ“Š Diagram type detected: fire protection
   âœ… VISION EXTRACTION COMPLETE:
      Type: fire protection
      Entities: 5
      Relationships: 3
      Summary: This diagram shows the fire protection plan for a freezer area including docks and component details
      âœ… Page 3: 5 entities, 3 rels
   âœ… Vision complete: 16 entities total

ğŸ“‡ Step 5: BM25 indexing...
   âœ… BM25 indexed 111 chunks

ğŸ•¸ï¸ Step 6: Saving to Neo4j...
   ğŸ“Š Total entities: 615
   ğŸ“Š Total relationships: 129
   âœ… Neo4j: 615 entities saved
   âœ… Neo4j: 129 relationships saved

ğŸ’¾ Step 7: Saving to ChromaDB...
   ğŸ“Š Vector points to save: 111
   âœ… Saved batch 1/3
   âœ… Saved batch 2/3
   âœ… Saved batch 3/3
   âœ… ChromaDB: 111 vectors saved

================================================================================
âœ… PROCESSING COMPLETE!
================================================================================

19:47:20 Successfully completed app.workers.ingestion_worker.process_document('uploads\\72ff19e0-5f98-4ee8-8484-72dce335df53.pdf', '72ff19e0-5f98-4ee8-8484-72dce335df53', 'BEK Bruno - FP.pdf') job in 0:04:43.152510s on worker 8f85a4a1eb1145d9aa2ba9adf72d11e6
19:47:20 construction-queue: Job OK (b6ef0ac9-85e0-411d-9c24-2f05d14168c1)
19:47:20 Result is kept for 500 seconds
19:47:20 construction-queue: app.workers.ingestion_worker.process_document('uploads\\5c6bc829-c56e-4034-85ea-8c4bfefb28ff.pdf', '5c6bc829-c56e-4034-85ea-8c4bfefb28ff', 'BEK Bruno - Refrigeration (Rev1).pdf') (81fcd64e-c05f-418e-a5e1-a1b172b44c20)

================================================================================
âš¡ PROCESSING: BEK Bruno - Refrigeration (Rev1).pdf
ğŸ†” Doc ID: 5c6bc829-c56e-4034-85ea-8c4bfefb28ff
================================================================================

ğŸ”§ Step 1: Initializing services...
   ğŸ“‚ ChromaDB path: C:\chroma\construction_graph
ğŸ”§ [EntityExtractor] Initializing with model: gpt-4o
âœ… [EntityExtractor] Ready
   âœ… All services ready

ğŸ“– Step 2: PDF Processing...
   ğŸ“„ Opening PDF...
   ğŸ“Š Found 7 pages
   ğŸ”„ Processing in 4 batches of 2 pages each...

   âš™ï¸ Batch 1/4: pages 1-2...
   âœ… Created 2 chunks from text
   âœ… Created 2 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 7 entities, 0 relationships
   âœ… LLM extraction: 4 entities, 3 relationships
   âœ… Total after deduplication: 9 entities, 3 relationships
      âœ… Batch 1 complete: 4 chunks, 9 entities
   âš™ï¸ Batch 2/4: pages 3-4...
   âœ… Created 2 chunks from text
   âœ… Created 2 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 4 entities, 0 relationships
   âœ… LLM extraction: 3 entities, 2 relationships
   âœ… Total after deduplication: 7 entities, 2 relationships
      âœ… Batch 2 complete: 4 chunks, 7 entities
   âš™ï¸ Batch 3/4: pages 5-6...
   âœ… Created 2 chunks from text
   âœ… Created 2 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 2 entities, 0 relationships
   âœ… LLM extraction: 4 entities, 2 relationships
   âœ… Total after deduplication: 6 entities, 2 relationships
      âœ… Batch 3 complete: 4 chunks, 6 entities
   âš™ï¸ Batch 4/4: pages 7-7...
   âœ… Created 2 chunks from text
   ğŸ” Starting text entity extraction...
   âœ… Regex extraction: 1 entities, 0 relationships
   âœ… LLM extraction: 2 entities, 1 relationships
   âœ… Total after deduplication: 3 entities, 1 relationships
      âœ… Batch 4 complete: 2 chunks, 3 entities

   âœ… Text extraction complete: 7 pages
   âœ… Total chunks: 14
   âœ… Total entities: 25, relationships: 8

ğŸ”— Step 3: Creating vector embeddings...
   ğŸ¯ Using model: text-embedding-3-small (1536 dimensions)
   âœ… Embedded batch 1/1
   âœ… Created 14 vector points

ğŸ” Step 4: Vision extraction (first 3 pages)...
   ğŸ“¸ Processing page 1...

ğŸ–¼ï¸ [VISION EXTRACTION] Page 1
   Image size: 870736 bytes (base64)
   ğŸ”„ Calling GPT-4o Vision API...
   âœ… Vision API response received
   âœ… JSON parsed successfully
   ğŸ“Š Diagram type detected: HVAC
   âœ… VISION EXTRACTION COMPLETE:
      Type: HVAC
      Entities: 8
      Relationships: 0
      Summary: This diagram shows the layout of air units with variable frequency drives in a freezer area.
      âœ… Page 1: 8 entities, 0 rels
   ğŸ“¸ Processing page 2...

ğŸ–¼ï¸ [VISION EXTRACTION] Page 2
   Image size: 921188 bytes (base64)
   ğŸ”„ Calling GPT-4o Vision API...
   âœ… Vision API response received
   âš ï¸ Vision API refused to analyze (content policy)
   ğŸ“„ Refusal message: I'm unable to analyze images directly. However, if you provide details from the diagram, I can help you format the information into the JSON structure...
      âœ… Page 2: 0 entities, 0 rels
   ğŸ“¸ Processing page 3...

ğŸ–¼ï¸ [VISION EXTRACTION] Page 3
   Image size: 738136 bytes (base64)
   ğŸ”„ Calling GPT-4o Vision API...
   âœ… Vision API response received
   âœ… JSON parsed successfully
   ğŸ“Š Diagram type detected: HVAC
   âœ… VISION EXTRACTION COMPLETE:
      Type: HVAC
      Entities: 8
      Relationships: 4
      Summary: This diagram shows the layout of air units and their associated variable frequency drives in a dry s
      âœ… Page 3: 8 entities, 4 rels
   âœ… Vision complete: 16 entities total

ğŸ“‡ Step 5: BM25 indexing...
   âœ… BM25 indexed 14 chunks

ğŸ•¸ï¸ Step 6: Saving to Neo4j...
   ğŸ“Š Total entities: 41
   ğŸ“Š Total relationships: 12
   âœ… Neo4j: 41 entities saved
   âœ… Neo4j: 12 relationships saved

ğŸ’¾ Step 7: Saving to ChromaDB...
   ğŸ“Š Vector points to save: 14
   âœ… Saved batch 1/1
   âœ… ChromaDB: 14 vectors saved

================================================================================
âœ… PROCESSING COMPLETE!
================================================================================